'use strict';

(function(angular){

  var _template =  'encounter-select/encounter-select.template.html';

  var app = angular.module('encounter.select', []);
  
  app.component('encounterSelect',{
      
      restrict: 'E',
      bindings: {
        load: '&',
        showNextEncounter: '='
      },
      templateUrl: _template,
      controller: SelectController,
      controllerAs: 'esel'
    });
  
  
  function SelectController(){
    var self = this;
    
    self.$onInit = function(){

      self.enc_list = [232369324,225480266,225844546,231534675,228776193,232214941,231523877,224860824,226244227,229431351,232891169,232571584,225355694,228566912,233864685,226141372,225434978,227378491,227191128,226154272,230575560,228936017,225487556,226978676,232399644,228919500,230571115,228815350,232994600,229189938,228126586,230331479,233391258,230076770,228148556,229490624,227988621,229958594,225734618,229480842,232175252,227259351,229589580,232214531,231420539,228138495,229344065,227976340,226263355,230010491,226132031,225190435,228814855,228754517,224863497,226121136,232061356,228144879,228305789,231521718,229628158,232016078,224916809,225013271,229628538,230882490,228817968,228128933,233032003,226314947,223458422,227424265,231001655,228818458,232994838,225380700,231895506,225482499,230464063,228763172,232038603,226933189,229428189,231877712,227324682,231525290,224861550,225249341,229455410,228148713,233873643,231429937,229960867,227637032,231155670,232172254,228797588,232707568,228586859,231251184,225476777,229449164,224933870,232781088,232522577,229906020,224806314,226649907,226339193,228399390,224718124,224723382,225708379,229566401,226157489,227677712,231007317,233046215,226585145,228243299,229476904,226015737,230157053,231033061,228436391,224534445,226121040,232457766,232322180,227350232,231156512,226665788,228141652,226006344,226015698,231431229,229190977,233679919,226947661,227430844,226554148,228078408,226875541,225599872,229219437,225383546,230116573,229178153,225359742,225623442,224978482,227347359,231289189,230019909,230077883,233168801,225925660,225584347,226397593,229182710,226142029,229270041,226950919,228164712,226078281,226078871,227970819,231281676,224745282,229167326,233221382,228436411,225295476,230143720,230307529,225831933,233390775,225743110,230870632,233521649,227179890,226794001,232398747,228666302,226153615,226300989,225153603,225443736,225283445,229728104,228826469,231420614,233204694,228563690,226088032,225123857,226109321,224708879,230856865,233048692,230862139,232231880,228838693,228768163,224858030,225590573,230888797,226353535,229581596,227490183,225487587,228809186,224963625,233866277,225698666,227124339,225468211,229486630,226015481,231434641,231612222,231993633,232029585,226212082,231728841,229841898,230135498,228941198,223268132,226712516,225244802,233204336,230157025,231896588,230863124,226155385,226249823,231118774,231096007,228772638,225768929,226344634,230154710,226401985,231031916,229488171,232230000,231246649,230152709,231281480,226142107,232194467,230927336,227083211,225154975,226143267,229683465,228904177,228779754,226122794,227346878,225341737,232889891,226385917,226756954,227473283,232216637,228814297,224868322,230518411,229972119,230285532,230856520,227197797,225362916,225579689,230854789,231856545,232167409,233361064,231025859,233868600,225758962,227991222,227477561,226752142];

      let stored = localStorage.getItem('activeEncounter');

      if (self.enc_list.indexOf(stored) != -1)
        self.eid = stored;
      else{
        self.eid = "232369324";
        localStorage.setItem('activeEncounter', self.eid);
      }

      self.showNextEncounter = function(reverse) {
        let idx = self.enc_list.indexOf(parseInt(self.eid));

        if (!reverse){
          if(idx < self.enc_list.length - 1)
            loadEncounter(self.enc_list[idx + 1]);
        }
        else{
          if(idx > 0)
            loadEncounter(self.enc_list[idx - 1]);
        }
      };
    }

    function loadEncounter(enc){
      self.eid = enc.toString();      
      localStorage.setItem('activeEncounter', self.eid);
      self.load({encounter: self.eid});
    }

    self.selectEncounter = function(){
      // console.log("changeEncounter", self.eid);
      if(self.eid == null)
        return
      loadEncounter(self.eid);
    }

    
    
  }
  
})(window.angular);